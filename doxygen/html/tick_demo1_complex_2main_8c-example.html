<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer Library API: tick_demo1_complex/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer Library API
   &#160;<span id="projectnumber">V2.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tick_demo1_complex_2main_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">tick_demo1_complex/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<h2>===== Description =====</h2>
<p>This demo shows how to use the complex version of the system tick. It can also be used an example of how to overwrite the default netcruzer tick with a custom implementation. It is enabled by adding the following line to the projdefs.h file:<br/>
 </p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NZSYS_ENABLE_COMPLEX_TICK  //Indicates that the complex tick file nz_tickCx must be used, and not nz_tick&lt;br&gt;</span></div>
</div><!-- fragment --><p> The system tick uses Timer 1, and has a period of 1ms. Each 1ms an interrupt is triggered, and the 32-bit system tick is incremented. To make code smaller and more efficient, various functions are available for using 8, 16 and 32-bit variables for implementing timers and delays. The 16-bit variants are the most efficient, and create the smallest code, seeing that the native data size for this CPU is 16-bits. The 8-bit variants use the least RAM. The 32-bit variables can create the longest delays.</p>
<h2>===== Required Hardware =====</h2>
<p>This project can be run on any of our <a href="http://netcruzer.com/products-sbc66-main/">SBC66 Netcruzer boards</a>. For prototyping, we recommend combining this board with a <a href="http://netcruzer.com/products-sbc66-prototype/">Prototyping Board</a>, like the PT66ECI for example. This low cost prototyping board makes all the I/O ports of the SBC66 board available via marked labels on the PCB. It also provides a reset and firmware button that simplifies prototyping.</p>
<h2>===== Building Project =====</h2>
<p>This project is located in the "src/demos/general/tick_demo1_complex" folder of the <a href="http://netcruzer.com/nzdownload/" target="_blank">Netcruzer Download</a>. To compile for Netcruzer Board, open this project in MPLAB X, and select the "Project Configuration" for desired board. For example "SBC66ECL_R2" for the <a href="http://netcruzer.com/sbc66ecl.html">SBC66ECL</a> Revision 2 board. For details <a href="http://netcruzer.com/nz/doc/building_projects/" target="_blank">click here</a>.<br/>
 A common error is "The system cannot find the path specified". This generally means you don't have the required XC16 compiler version installed. Go to "Project Properties", and select your installed XC16 compiler in the "Project Configuration" section.</p>
<h2>===== Programming Board =====</h2>
<p>After compiling (build), the board can be programmed via the <a href="http://netcruzer.com/nz/doc/update_firmware_usb" target="_blank">USB Bootloader</a> or a <a href="http://netcruzer.com/nz/doc/update_firmware_prog" target="_blank">PIC Programmer</a>. USB Programming is simplified when using the SBC board together with a <a href="http://netcruzer.com/nz/doc/update_firmware_usb_pt66" target="_blank">Prototype Board</a>.</p>
<h2>===== File History =====</h2>
<p>2012-08-08, David H. (DH):</p>
<ul>
<li>Initial version</li>
</ul>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define THIS_IS_MAIN_FILE   //Uniquely identifies this as the file with the main application entry function main()</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">// Includes</span></div>
<div class="line"><span class="preprocessor">#include &quot;HardwareProfile.h&quot;</span>            <span class="comment">//Required for all Netcruzer projects</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    DWORD tmr32Task1Hour;           <span class="comment">//Do something every hour (32-bit, 1ms Timer)</span></div>
<div class="line">    WORD tmrFlashLed;               <span class="comment">//Timer definining LED flash rate (16-bit, 1ms Timer)</span></div>
<div class="line">    WORD tmr16bit256ms_Task1Hour;   <span class="comment">//Do something (approximately) every hour (16-bit, 256ms Timer)</span></div>
<div class="line">    BYTE tmr8bit16ms_ToggleX5;      <span class="comment">//Toggle port 5 (old port name X5) (8-bit, 16ms Timer)</span></div>
<div class="line"></div>
<div class="line">    <a name="a0"></a><a class="code" href="nz__netcruzer_8h.html#adfed4b7fa101ade26bd57d654f4c7bcd">nzSysInitDefault</a>();             <span class="comment">//Default initialization. All ports inputs. All analog features disabled. Tick 1ms.</span></div>
<div class="line"></div>
<div class="line">    tmr32Task1Hour = <a name="a1"></a><a class="code" href="nz__tick_8h.html#a9e3bc9ae0d1e665870b33b18da86cb6f">tick32Get</a>();   <span class="comment">//Set with current 32-bit tick.</span></div>
<div class="line">    tmrFlashLed = <a name="a2"></a><a class="code" href="nz__tick_8h.html#a1488f07fe5f1db9ec750bba8d7347759">tick16Get</a>();        <span class="comment">//Set with current 16-bit tick.</span></div>
<div class="line">    tmr16bit256ms_Task1Hour = <a name="a3"></a><a class="code" href="nz__tick_cx_8h.html#afa63f9729affc4672c70b3fe395cdb0d">tick16Get_256ms</a>();   <span class="comment">//Set with current 16-bit tick, 256 ms tick</span></div>
<div class="line">    tmr8bit16ms_ToggleX5 = <a name="a4"></a><a class="code" href="nz__tick_cx_8h.html#a31ea798d8e2d5841650e418c6d2a2f9d">tick8Get_16ms</a>();        <span class="comment">//Set with current 8-bit, 16 ms tick</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Set System LED port, and port 5 (old port name X5) as outputs. Setting a DIR_xxx bit to 1 set&#39;s corresponding port to input, and 0 as output</span></div>
<div class="line">    DIR_SYSLED = 0;</div>
<div class="line">    DIR_05 = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//Flash System LED every 200ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a5"></a><a class="code" href="nz__tick_8h.html#a6ba5b7c684a01befa0d9522a7efa880a">tick16TestTmr</a>(tmrFlashLed)) {</div>
<div class="line">            <a name="a6"></a><a class="code" href="nz__tick_8h.html#abd9d8cafb5bb9c655365cebd7bc2bd56">tick16UpdateTmrMS</a>(tmrFlashLed, 200);             <span class="comment">//Update timer to expire in 200ms again</span></div>
<div class="line"></div>
<div class="line">            LAT_SYSLED = !LAT_SYSLED;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Do something each hour = 3,600 seconds = 3,600,000 ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a7"></a><a class="code" href="nz__tick_8h.html#a3b7f81edf4831a872cf73a1819b78e3f">tick32TestTmr</a>(tmr32Task1Hour)) {</div>
<div class="line">            <a name="a8"></a><a class="code" href="nz__tick_8h.html#a48f2234e4328d8581a028dcab66d0378">tick32UpdateTmrMin</a>(tmr32Task1Hour, 60);</div>
<div class="line">            <span class="comment">//tmr32Task1Hour += 3600000;   //Set to trigger again in 1 hour (3,600,000 ms)</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//..... Add code here to be executed every hour</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Do something (approximately) each hour = 3,600 seconds = 3,600,000 ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a9"></a><a class="code" href="nz__tick_cx_8h.html#af7d2692b66f590a5e7883fd4184d97fb">tick16HasExpired_256ms</a>(tmr16bit256ms_Task1Hour)) {</div>
<div class="line">            <span class="comment">//Set to trigger again in 1 hour (3,600,000 ms) = 3,600,000/256 = 14,062 (actually 3,599,872)</span></div>
<div class="line">            tmr16bit256ms_Task1Hour += 14062;</div>
<div class="line"></div>
<div class="line">            <span class="comment">//..... Add code here to be executed every hour</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Toggle port 5 (old port name X5) every 800ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="nz__tick_cx_8h.html#ab332a012f78fa79f709681d243c92e5a">tick8HasExpired_16ms</a>(tmr8bit16ms_ToggleX5)) {</div>
<div class="line">            tmr8bit16ms_ToggleX5 += 50;   <span class="comment">//Set to trigger again in 50x16 = 800ms</span></div>
<div class="line"></div>
<div class="line">            LAT_05 = !LAT_05;</div>
<div class="line">        }</div>
<div class="line">    }<span class="comment">//end while</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}<span class="comment">//end main</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 9 2014 15:08:18 for Netcruzer Library API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
