<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer Library API: db66dev1_lcd2s/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer Library API
   &#160;<span id="projectnumber">V2.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db66dev1_lcd2s_2main_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">db66dev1_lcd2s/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<h2>===== Description =====</h2>
<p>This demo contains some test code for the DB66DEV1 development daughter board. The potentiometer, connected to analog input 3 (old port name X3) controls the frequency of the buzzer connected to port 34 (old port name Y4). This port is configured as a PWM output. The 4 buttons on the DB66DEV1 will simply control LEDs 1 to 4 (on/off when button pressed/depressed). LEDs 5 to 8 run from left to right, incremented each 100ms.</p>
<p>Information is written out to a serial LCD2S type display.</p>
<p>Additionally the the System LED blinks every second.</p>
<p>The DB66DEV1 has a potentiometer on port 3 (old port name X3). This port has an ADC (Analog to Digital) converter on all SBC66 Netcruzer boards. The SBC66 Netcruzer boards have 12 Analog input ports, port 0-5 and 30-35 (old port names X0-X5, and Y0-Y5). For details see <a href="http://netcruzer.com/nzdoc-sbc66-ports/">http://netcruzer.com/nzdoc-sbc66-ports/</a> Port 3 is configured as an Analog Inputs. By default the ADC is configured for voltages between 0-2.5V, include "#define ADC_3V3_VREF" in projdefs.h for 0-3.3V range.</p>
<p>The DB66DEV1 has 4 button on ports 30, 31, 32 and 33 (old port names Y0, Y1, Y2 and Y3). They are all configured as inputs.</p>
<p>The DB66DEV1 has 8 LEDs on ports 6, 7, 8, 9, 26, 27, 28, 29 (Old port names X6, X7, X8, X9, T4, T5, T6 and T7). These ports are all configured as outputs.</p>
<p>The DB66DEV1 has a buzzer on port 34 (old port name Y4).</p>
<h2>===== Required Hardware =====</h2>
<p>The project requires a <a href="http://netcruzer.com/products-sbc66-main/">SBC66 Netcruzer board</a> with an USB Port (not USB Host), a <a href="http://netcruzer.com/db66dev1.html">DB66DEV1</a> development board, and a <a href="http://netcruzer.com/lcd2s/">LCD2S</a> type serial LCD display. The DB66DEV1 is plugged into the daughter board connector of the SBC66 board, and the LCD2S is plugged into the red Micro Match connector on the SBC66 board.</p>
<h2>===== Building Project =====</h2>
<p>This project is located in the "src/demos/db66dev1/db66dev1_lcd2s" folder of the <a href="http://netcruzer.com/nzdownload/" target="_blank">Netcruzer Download</a>. To compile for Netcruzer Board, open this project in MPLAB X, and select the "Project Configuration" for desired board. For example "SBC66ECL_R2" for the <a href="http://netcruzer.com/sbc66ecl.html">SBC66ECL</a> Revision 2 board. For details <a href="http://netcruzer.com/nz/doc/building_projects/" target="_blank">click here</a> A common error is "The system cannot find the path specified". This generally means you don't have the required XC16 compiler version installed. Go to "Project Properties", and select your installed XC16 compiler in the "Project Configuration" section.</p>
<h2>===== Programming Board =====</h2>
<p>After compiling (build), the board can be programmed via the <a href="http://netcruzer.com/nz/doc/update_firmware_usb" target="_blank">USB Bootloader</a> or a <a href="http://netcruzer.com/nz/doc/update_firmware_prog" target="_blank">PIC Programmer</a>. USB Programming is simplified when using the SBC board together with a <a href="http://netcruzer.com/nz/doc/update_firmware_usb_pt66" target="_blank">Prototype Board</a>.</p>
<h2>===== File History =====</h2>
<p>2013-05-03, David H. (DH):</p>
<ul>
<li>Initial version</li>
</ul>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define THIS_IS_MAIN_FILE   //Uniquely identifies this as the file with the main application entry function main()</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;HardwareProfile.h&quot;</span>    <span class="comment">//Required for all Netcruzer projects</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="nz__db66dev1_8h.html" title="Contains hardware specific defines for DB66DEV1 Revision 1 board. ">nz_db66dev1.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;nz_i2c1.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="nz__lcd2s_8h.html" title="Serial LCD Display handler. ">nz_lcd2s.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> lcdBuf[128];</div>
<div class="line">    <span class="keywordtype">float</span> freq;</div>
<div class="line">    WORD potValue = 0, newPotValue = 0;</div>
<div class="line">    BYTE ledRotate = 1;</div>
<div class="line">    WORD tmrFlashLed = 0;   <span class="comment">//Timer for flashing system LED</span></div>
<div class="line">    WORD tmrProcessIO = 0;  <span class="comment">//Timer for processing I/O</span></div>
<div class="line"></div>
<div class="line">    <a name="a0"></a><a class="code" href="nz__netcruzer_8h.html#adfed4b7fa101ade26bd57d654f4c7bcd">nzSysInitDefault</a>();         <span class="comment">//Default initialization. All ports inputs. All analog features disabled. Tick 1ms</span></div>
<div class="line"></div>
<div class="line">    DIR_SYSLED = OUTPUT_PIN;    <span class="comment">//Set System LED port as outputs</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Initialize DB66DEV1, all LEDs are output and turned off, Buttons inputs</span></div>
<div class="line">    db66dev1_Init();</div>
<div class="line"></div>
<div class="line">    adcOpen(ADC_OPEN_A3);       <span class="comment">//Configure 3 (old port name X3) as ADC channels</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Configure Port 32 (old port name Y4) (Buzzer on DB66DEV1) as PWM channel 1, with default frequency of 16kHz.</span></div>
<div class="line">    <span class="comment">//To change the default frequency, Redefine PWM1_FREQ in projdefs.h file for desired</span></div>
<div class="line">    <span class="comment">//frequency. For example: #define PWM1_FREQ  PWM_FREQ_1600HZ</span></div>
<div class="line">    pwm1OpenDefault(PPS_OUT_34, 0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Open I2C 1 port at 400kbit/second. I2C 1 is used for the LCD display (red connector) on all Netcruzer SBC66 board.</span></div>
<div class="line">    i2c1Open(I2C_BAUD_100K);</div>
<div class="line"></div>
<div class="line">    delay_ms(300); <span class="comment">//Give LCD2S time to initialize itself</span></div>
<div class="line">    lcdInit();</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Write Parsed String to LCD. See &quot;Write Parsed String&quot; command in LCD2S documentation (http://netcruzer.com/doc?lcd2s)</span></div>
<div class="line">    <span class="comment">//for details. The &#39;\f&#39; character causes &quot;clear screen and positions cursor at home position&quot;.</span></div>
<div class="line">    <span class="comment">//Writes &quot;Hello&quot; to first line, and &quot;World!&quot; to second line</span></div>
<div class="line">    lcdDisplayString(0, <span class="stringliteral">&quot;\fDB66DEV1 Demo&quot;</span>);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        <a name="a1"></a><a class="code" href="nz__netcruzer_8h.html#ad9122988f6a0fb44a89afca419b66e65">nzSysTaskDefault</a>();     <span class="comment">//Main netcruzer task, call in main loop.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">//Process I/O every 50ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a2"></a><a class="code" href="nz__tick_8h.html#a6ba5b7c684a01befa0d9522a7efa880a">tick16TestTmr</a>(tmrProcessIO)) {</div>
<div class="line">            <a name="a3"></a><a class="code" href="nz__tick_8h.html#abd9d8cafb5bb9c655365cebd7bc2bd56">tick16UpdateTmrMS</a>(tmrProcessIO, 100);    <span class="comment">//Update timer to expire in 100ms again</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//Get the potentiometer analog input, will be a value from 0 to 255</span></div>
<div class="line">            newPotValue = adcReadChan8Bit(ADC_CH_A3);</div>
<div class="line"></div>
<div class="line">            <span class="comment">//Only enter if potentiometer value has changed</span></div>
<div class="line">            <span class="keywordflow">if</span> (potValue!=newPotValue) {</div>
<div class="line">                potValue = newPotValue;</div>
<div class="line">                </div>
<div class="line">                freq = (potValue*10)+450;</div>
<div class="line"></div>
<div class="line">                <span class="comment">//Use 0.1 for duty cycle, so buzzer is not too loud (0.5 is maximum volume)</span></div>
<div class="line">                pwmSetFreqAndDutyCycle(1, freq, 0.1);</div>
<div class="line"></div>
<div class="line">                <span class="comment">//If potentiometer is 0, turn buzzer off (duty cycle of 0)</span></div>
<div class="line">                <span class="keywordflow">if</span> (potValue == 0)</div>
<div class="line">                    pwmSetDutyCycle(1, 0);</div>
<div class="line"></div>
<div class="line">                <span class="comment">//Write to second line of LCD display - \r\n = Beginning of LCD, skip to next line</span></div>
<div class="line">                <a name="a4"></a><a class="code" href="stdio_8h.html#a9cafd44c2e1bfa384f71d56949e3b3fc">sprintf</a>(lcdBuf, <span class="stringliteral">&quot;\r\nFrequency = %04.0fHz\nADC A3 = %04u&quot;</span>, (<span class="keywordtype">double</span>)freq, potValue);</div>
<div class="line"></div>
<div class="line">               <span class="comment">//Write Parsed String to LCD. See &quot;Write Parsed String&quot; command in LCD2S documentation (http://netcruzer.com/doc?lcd2s)</span></div>
<div class="line">                lcdDisplayString(0, lcdBuf);</div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            <span class="comment">//LEDs 1 to 4 are controlled by buttons 1 to 4</span></div>
<div class="line">            LAT_LED1 = !PIN_BUTTON1;    <span class="comment">//Turn on LED 1 if button 1 pressed, and off if not</span></div>
<div class="line">            LAT_LED2 = !PIN_BUTTON2;    <span class="comment">//Turn on LED 2 if button 1 pressed, and off if not</span></div>
<div class="line">            LAT_LED3 = !PIN_BUTTON3;    <span class="comment">//Turn on LED 3 if button 1 pressed, and off if not</span></div>
<div class="line">            LAT_LED4 = !PIN_BUTTON4;    <span class="comment">//Turn on LED 4 if button 1 pressed, and off if not</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//Rotate LEDs 5 to 8</span></div>
<div class="line">            ledRotate = ledRotate &lt;&lt; 1;</div>
<div class="line">            <span class="keywordflow">if</span> (ledRotate==0x10)</div>
<div class="line">                ledRotate = 0x01;</div>
<div class="line">            <span class="keywordflow">if</span> (ledRotate&amp;0x01) LAT_LED5 = 1; <span class="keywordflow">else</span> LAT_LED5 = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (ledRotate&amp;0x02) LAT_LED6 = 1; <span class="keywordflow">else</span> LAT_LED6 = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (ledRotate&amp;0x04) LAT_LED7 = 1; <span class="keywordflow">else</span> LAT_LED7 = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (ledRotate&amp;0x08) LAT_LED8 = 1; <span class="keywordflow">else</span> LAT_LED8 = 0;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="comment">//Flash system LED every 500ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="nz__tick_8h.html#a6ba5b7c684a01befa0d9522a7efa880a">tick16TestTmr</a>(tmrFlashLed)) {</div>
<div class="line">            <a class="code" href="nz__tick_8h.html#abd9d8cafb5bb9c655365cebd7bc2bd56">tick16UpdateTmrMS</a>(tmrFlashLed, 500); <span class="comment">//Update timer to expire in 500ms again</span></div>
<div class="line">            LAT_SYSLED = !LAT_SYSLED;       <span class="comment">//Toggle System LED</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }<span class="comment">//end while</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}<span class="comment">//end main</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if !defined(PPS_OUT_34)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#error &quot;Can not build for this target, it does not have a reconfigurable Port 34 (old port name Y4)! This is the case for the SBC66EC Revision 1 board. Select a different Configuration!&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 9 2014 15:08:18 for Netcruzer Library API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
