<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer Library API: cirbuf_demo1/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer Library API
   &#160;<span id="projectnumber">V2.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cirbuf_demo1_2main_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">cirbuf_demo1/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<h2>===== Description =====</h2>
<p>This demo show how to use "Circular Buffers" as specified in the "nz_circularBuffer.h" interface.</p>
<p>USB debugging is enabled (see "Debug Configuration" in projdefs.h), meaning all debug and system output is directed via USB to the "Netcruzer USB Terminal" app. It will be displayed in the "Debug" tab of this app, which can be downloaded here:<br/>
 <a href="http://www.netcruzer.com/usbterminal/">http://www.netcruzer.com/usbterminal/</a></p>
<p>Additionally debug message can also be processed in the debugService() function. This example simply checks if "hi" is received, and if so, replies with "Hello". Sending and receiving debug message is done in the "Debug" tab of the "Netcruzer USB Terminal" app.</p>
<p><b>Details:</b><br/>
 The "Netcruzer Library" contains two circular buffer implementations. Any one can be used for this project. The standard one (nz_circularBufferStd.c) is used for this demo, requiring the following to be done(is already done!):</p>
<ul>
<li>Copy <a class="el" href="nz__circular_buffer_8h.html#nz_circularBuffer_conf">Circular Buffer Configuration</a> section from <a class="el" href="nz__circular_buffer_8h.html" title="This file defines a Circular Buffer interface. ">nz_circularBuffer.h</a> to projdefs.h</li>
<li>In this copied section, ensure "#define    CIRBUF_USE_CIRCULAR_BUFFER_STD" is uncommented. This configures what "Circular Buffer" implementation is used.</li>
<li>Include "nz_circularBufferStd.c" in project</li>
</ul>
<h2>===== Required Hardware =====</h2>
<p>The project requires a <a href="http://netcruzer.com/products-sbc66-main/">SBC66 Netcruzer board</a> with an USB Port (not USB Host).</p>
<h2>===== Building Project =====</h2>
<p>This project is located in the "src/demos/usb/cirbuf_demo1" folder of the <a href="http://netcruzer.com/nzdownload/" target="_blank">Netcruzer Download</a>. To compile for Netcruzer Board, open this project in MPLAB X, and select the "Project Configuration" for desired board. For example "SBC66ZL_R1" for the <a href="http://netcruzer.com/sbc66zl.html">SBC66ZL</a> Revision 1 board. For details <a href="http://netcruzer.com/nz/doc/building_projects/" target="_blank">click here</a> A common error is "The system cannot find the path specified". This generally means you don't have the required XC16 compiler version installed. Go to "Project Properties", and select your installed XC16 compiler in the "Project Configuration" section.</p>
<h2>===== Programming Board =====</h2>
<p>After compiling (build), the board can be programmed via the <a href="http://netcruzer.com/nz/doc/update_firmware_usb" target="_blank">USB Bootloader</a> or a <a href="http://netcruzer.com/nz/doc/update_firmware_prog" target="_blank">PIC Programmer</a>. USB Programming is simplified when using the SBC board together with a <a href="http://netcruzer.com/nz/doc/update_firmware_usb_pt66" target="_blank">Prototype Board</a>.</p>
<h2>===== File History =====</h2>
<p>2013-07-22, David H. (DH):</p>
<ul>
<li>Initial version</li>
</ul>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define THIS_IS_MAIN_FILE   //Uniquely identifies this as the file with the main application entry function main()</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;HardwareProfile.h&quot;</span>    <span class="comment">//Required for all Netcruzer projects</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="nz__helpers_8h.html" title="Netcruzer Helper Functions. ">nz_helpers.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Add debugging. DEBUG_CONF_MAIN macro sets debugging to desired level (defined in projdefs.h)</span></div>
<div class="line"><span class="preprocessor">#if !defined(DEBUG_CONF_MAIN)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define DEBUG_CONF_MAIN     DEBUG_CONF_DEFAULT   //Default Debug Level, disabled if DEBUG_LEVEL_ALLOFF defined, else DEBUG_LEVEL_ERROR</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MY_DEBUG_LEVEL   DEBUG_CONF_MAIN</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="nz__debug_8h.html" title="This file defines a Debug interface. ">nz_debug.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">//Create and initialize a streaming type &quot;Circular Buffer&quot; with no formatting</span></div>
<div class="line">    <a name="_a0"></a><a class="code" href="struct___c_i_r_b_u_f.html">CIRBUF</a> cbufTest;</div>
<div class="line">    BYTE testBuf[128];</div>
<div class="line">    <a name="a1"></a><a class="code" href="nz__circular_buffer_8h.html#a52ea37f827a113e2451b36e8ce603f2b">cbufInit</a>(&amp;cbufTest, testBuf, <span class="keyword">sizeof</span>(testBuf), <a name="a2"></a><a class="code" href="nz__circular_buffer_8h.html#ab484ba359723d9b5135d8a6d4e64878b">CIRBUF_FORMAT_NONE</a> | <a name="a3"></a><a class="code" href="nz__circular_buffer_8h.html#add444d24fc4e31afa0b16aa26b0df054">CIRBUF_TYPE_STREAMING</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Default initialization. All ports inputs. All analog features disabled. Tick 1ms</span></div>
<div class="line">    <a name="a4"></a><a class="code" href="nz__netcruzer_8h.html#adfed4b7fa101ade26bd57d654f4c7bcd">nzSysInitDefault</a>();</div>
<div class="line"></div>
<div class="line">    delay_ms(1000);     <span class="comment">//Delay 1 second at startup</span></div>
<div class="line"></div>
<div class="line">    <a name="a5"></a><a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\nThis will be displayed in the debug tab of the &#39;Netcruzer USB Terminal&#39; app!&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Do some checks on buffer</span></div>
<div class="line">    <span class="comment">//&lt;b&gt;Output:&lt;/b&gt; &quot;Buffer is empty&quot;</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a6"></a><a class="code" href="nz__circular_buffer_8h.html#aee28b1631393336e0bcda4901f0fea95">cbufIsEmpty</a>(&amp;cbufTest)) {</div>
<div class="line">        <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\n\nBuffer is empty&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Add/remove bytes to/from buffer</span></div>
<div class="line">    <span class="comment">//&lt;b&gt;Output:&lt;/b&gt; &quot;After adding A and B, buffer size is 2&quot;</span></div>
<div class="line">    <a name="a7"></a><a class="code" href="nz__circular_buffer_8h.html#ad56769cd53384959977771c1f1fe3529">cbufPutByte</a>(&amp;cbufTest, <span class="charliteral">&#39;A&#39;</span>);</div>
<div class="line">    <a class="code" href="nz__circular_buffer_8h.html#ad56769cd53384959977771c1f1fe3529">cbufPutByte</a>(&amp;cbufTest, <span class="charliteral">&#39;B&#39;</span>);</div>
<div class="line">    <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\n\nAfter adding A and B, buffer size is %d&quot;</span>, <a name="a8"></a><a class="code" href="nz__circular_buffer_8h.html#a4b57fbfd7719fe18b0cdfa42594f6824">cbufGetCount</a>(&amp;cbufTest));</div>
<div class="line">    <a name="a9"></a><a class="code" href="nz__circular_buffer_8h.html#a7770b7064483faee83b2711323d2c685">cbufEmpty</a>(&amp;cbufTest);   <span class="comment">//Empty buffer</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Add string to buffer using cbufPutString(), and remove all byte using cbufGetByte().</span></div>
<div class="line">    <span class="comment">//Note that string terminating NULL character is NOT added to buffer.</span></div>
<div class="line">    <span class="comment">//&lt;b&gt;Output:&lt;/b&gt;&lt;br&gt;</span></div>
<div class="line">    <span class="comment">//  &quot;After adding &#39;Test String&#39;, buffer size is 11&quot;</span></div>
<div class="line">    <span class="comment">//  &quot;Test string is: Test String&quot;</span></div>
<div class="line">    <span class="comment">//  &quot;Size is now 0&quot;</span></div>
<div class="line">    <a name="a10"></a><a class="code" href="nz__circular_buffer_8h.html#aaf805c529e964381d5c1d5e8e98e893d">cbufPutString</a>(&amp;cbufTest, <span class="stringliteral">&quot;Test String&quot;</span>);  <span class="comment">//Add this to &quot;Circular Buffer&quot;</span></div>
<div class="line">    <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\n\nAfter adding &#39;Test String&#39;, buffer size is %d&quot;</span>, <a class="code" href="nz__circular_buffer_8h.html#a4b57fbfd7719fe18b0cdfa42594f6824">cbufGetCount</a>(&amp;cbufTest));</div>
<div class="line">    <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\nTest string is: &quot;</span>);               <span class="comment">//Below we will remove and print string</span></div>
<div class="line">    <span class="keywordflow">while</span> (<a name="a11"></a><a class="code" href="nz__circular_buffer_8h.html#a579f2af0e162697025c54bd7c1026203">cbufHasData</a>(&amp;cbufTest)) {</div>
<div class="line">        <a name="a12"></a><a class="code" href="stdio_8h.html#af4de2514b7778805db3815e8dd6cf09a">putchar</a>(<a name="a13"></a><a class="code" href="nz__circular_buffer_8h.html#a6b28e2ed0c70bc8e885f4598e98b3ed6">cbufGetByte</a>(&amp;cbufTest));        <span class="comment">//Print every character of the string</span></div>
<div class="line">    }</div>
<div class="line">    <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\nSize is now %d&quot;</span>, <a class="code" href="nz__circular_buffer_8h.html#a4b57fbfd7719fe18b0cdfa42594f6824">cbufGetCount</a>(&amp;cbufTest));</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Main loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <a name="a14"></a><a class="code" href="nz__netcruzer_8h.html#ad9122988f6a0fb44a89afca419b66e65">nzSysTaskDefault</a>();     <span class="comment">//Main netcruzer task, call in main loop.</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(HAS_NZ_DEBUGGING)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">void</span> debugService(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">//Check if a debug message was received</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a15"></a><a class="code" href="nz__circular_buffer_8h.html#af00a8ce0f071a8a966bc66294fdd9081">cbufHasWholePacket</a>(CIRBUF_RX_DEBUG)) {</div>
<div class="line">        <span class="comment">//Check if we received &quot;hi&quot;. If so, reply with &quot;Hello&quot; on a new line</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a16"></a><a class="code" href="nz__circular_buffer_8h.html#a5ce13d16c59e3a6e02d750c462d9aad6">cbufPacketStrcmp</a>(CIRBUF_RX_DEBUG, <span class="stringliteral">&quot;hi&quot;</span>) == 0) {</div>
<div class="line">            debugPutString(<span class="stringliteral">&quot;\nHello&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">//Check if we received &quot;hello&quot;. If so, reply with &quot;G&#39;Day Mate!&quot; on a new line</span></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="nz__circular_buffer_8h.html#a5ce13d16c59e3a6e02d750c462d9aad6">cbufPacketStrcmp</a>(CIRBUF_RX_DEBUG, <span class="stringliteral">&quot;myMessage...&quot;</span>) == 0) {</div>
<div class="line">            <span class="comment">//Do something.....</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Remove received packet. If it was not processed above, it is lost!</span></div>
<div class="line">        <a name="a17"></a><a class="code" href="nz__circular_buffer_8h.html#a41ff25acfdec531e69b8437abb11b720">cbufRemovePacket</a>(CIRBUF_RX_DEBUG);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 9 2014 15:08:18 for Netcruzer Library API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
