<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer Library API: cirbuf_packet_demo/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer Library API
   &#160;<span id="projectnumber">V2.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('cirbuf_packet_demo_2main_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">cirbuf_packet_demo/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<h2>===== Description =====</h2>
<p>This demo demonstrates how to use "Circular Buffers" as specified in the "nz_circularBuffer.h" interface.</p>
<p>USB debugging is enabled (see "Debug Configuration" in projdefs.h), meaning all debug and system output is directed via USB to the "Netcruzer USB Terminal" app. It will be displayed in the "Debug" tab of this app, which can be downloaded here:<br/>
 <a href="http://www.netcruzer.com/usbterminal/">http://www.netcruzer.com/usbterminal/</a></p>
<p>Additionally debug message can also be processed in the debugService() function. This example simply checks is "hi" is received, and if found, replies with "Hello". Sending and receiving debug message is done in the "Debug" tab of the "Netcruzer USB Terminal" app.</p>
<p><b>Details:</b><br/>
 The "Netcruzer Library" contains two circular buffer implementations. Any one can be used for this project. The standard one (nz_circularBufferStd.c) is used for this demo, requiring the following to be done(is already done!):</p>
<ul>
<li>Copy <a class="el" href="nz__circular_buffer_8h.html#nz_circularBuffer_conf">Circular Buffer Configuration</a> section from <a class="el" href="nz__circular_buffer_8h.html" title="This file defines a Circular Buffer interface. ">nz_circularBuffer.h</a> to projdefs.h</li>
<li>In this copied section, ensure "#define    CIRBUF_USE_CIRCULAR_BUFFER_STD" is uncommented. This configures what "Circular Buffer" implementation is used.</li>
<li>Include "nz_circularBufferStd.c" in project</li>
</ul>
<h2>===== Required Hardware =====</h2>
<p>The project requires a <a href="http://netcruzer.com/products-sbc66-main/">SBC66 Netcruzer board</a> with an USB Port (not USB Host).</p>
<h2>===== Building Project =====</h2>
<p>This project is located in the "src/demos/usb/cirbuf_packet_demo" folder of the <a href="http://netcruzer.com/nzdownload/" target="_blank">Netcruzer Download</a>. To compile for Netcruzer Board, open this project in MPLAB X, and select the "Project Configuration" for desired board. For example "SBC66ZL_R1" for the <a href="http://netcruzer.com/sbc66zl.html">SBC66ZL</a> Revision 1 board. For details <a href="http://netcruzer.com/nz/doc/building_projects/" target="_blank">click here</a> A common error is "The system cannot find the path specified". This generally means you don't have the required XC16 compiler version installed. Go to "Project Properties", and select your installed XC16 compiler in the "Project Configuration" section.</p>
<h2>===== Programming Board =====</h2>
<p>After compiling (build), the board can be programmed via the <a href="http://netcruzer.com/nz/doc/update_firmware_usb" target="_blank">USB Bootloader</a> or a <a href="http://netcruzer.com/nz/doc/update_firmware_prog" target="_blank">PIC Programmer</a>. USB Programming is simplified when using the SBC board together with a <a href="http://netcruzer.com/nz/doc/update_firmware_usb_pt66" target="_blank">Prototype Board</a>.</p>
<h2>===== File History =====</h2>
<p>2013-07-22, David H. (DH):</p>
<ul>
<li>Initial version</li>
</ul>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define THIS_IS_MAIN_FILE   //Uniquely identifies this as the file with the main application entry function main()</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;HardwareProfile.h&quot;</span>    <span class="comment">//Required for all Netcruzer projects</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="nz__helpers_8h.html" title="Netcruzer Helper Functions. ">nz_helpers.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Add debugging. DEBUG_CONF_MAIN macro sets debugging to desired level (defined in projdefs.h)</span></div>
<div class="line"><span class="preprocessor">#if !defined(DEBUG_CONF_MAIN)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define DEBUG_CONF_MAIN     DEBUG_CONF_DEFAULT   //Default Debug Level, disabled if DEBUG_LEVEL_ALLOFF defined, else DEBUG_LEVEL_ERROR</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MY_DEBUG_LEVEL   DEBUG_CONF_MAIN</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="nz__debug_8h.html" title="This file defines a Debug interface. ">nz_debug.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">//Create and initialize a &quot;Circular Buffer&quot;. It is initialized as a &quot;Packet Buffer&quot;. This</span></div>
<div class="line">    <span class="comment">//means we can write/read packets to/from the &quot;Circular Buffer&quot;. It is VERY IMPORTANT not</span></div>
<div class="line">    <span class="comment">//to use normal put and get functions for adding/removing data to a packet buffer! It will</span></div>
<div class="line">    <span class="comment">//corrupt the buffer!</span></div>
<div class="line">    <a name="_a0"></a><a class="code" href="struct___c_i_r_b_u_f.html">CIRBUF</a> cbufTest;</div>
<div class="line">    BYTE testBuf[128];</div>
<div class="line">    <a name="a1"></a><a class="code" href="nz__circular_buffer_8h.html#a52ea37f827a113e2451b36e8ce603f2b">cbufInit</a>(&amp;cbufTest, testBuf, <span class="keyword">sizeof</span>(testBuf), <a name="a2"></a><a class="code" href="nz__circular_buffer_8h.html#ab484ba359723d9b5135d8a6d4e64878b">CIRBUF_FORMAT_NONE</a> | <a name="a3"></a><a class="code" href="nz__circular_buffer_8h.html#aa8ffc8279962dab7ae703972908d4623">CIRBUF_TYPE_PACKET</a>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Two BYTE arrays used for testing</span></div>
<div class="line">    BYTE arr1[32], arr2[32];</div>
<div class="line">    BYTE* pByte;</div>
<div class="line">    WORD size;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Default initialization. All ports inputs. All analog features disabled. Tick 1ms</span></div>
<div class="line">    <a name="a4"></a><a class="code" href="nz__netcruzer_8h.html#adfed4b7fa101ade26bd57d654f4c7bcd">nzSysInitDefault</a>();</div>
<div class="line"></div>
<div class="line">    delay_ms(1000);     <span class="comment">//Delay 1 second at startup</span></div>
<div class="line"></div>
<div class="line">    <a name="a5"></a><a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\nThis will be displayed in the debug tab of the &#39;Netcruzer USB Terminal&#39; app!&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Do some checks on buffer</span></div>
<div class="line">    <span class="comment">//&lt;b&gt;Output:&lt;/b&gt; &quot;Buffer does not have any packets&quot;</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a name="a6"></a><a class="code" href="nz__circular_buffer_8h.html#af00a8ce0f071a8a966bc66294fdd9081">cbufHasWholePacket</a>(&amp;cbufTest) == FALSE)</div>
<div class="line">        <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\n\nBuffer does not have any packets&quot;</span>);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Add string to &quot;arr1&quot; buffer, than add it to &quot;Circular Buffer&quot; as a packet.</span></div>
<div class="line">    <span class="comment">//Note that string terminating NULL character is also added to buffer.</span></div>
<div class="line">    <span class="comment">//&lt;b&gt;Output:&lt;/b&gt;&lt;br&gt;</span></div>
<div class="line">    <span class="comment">//  &quot;After adding packet, cbufHasWholePacket() returns true&quot;</span></div>
<div class="line">    <span class="comment">//  &quot;Test string (size=12) is: Test String&quot;</span></div>
<div class="line">    <span class="comment">//  &quot;Size is now 0&quot;</span></div>
<div class="line">    <a name="a7"></a><a class="code" href="string_8h.html#a1eb9cae61e6a6282c28dbc298ef7297e">strcpy</a>((<span class="keywordtype">char</span>*)arr1, <span class="stringliteral">&quot;Test String&quot;</span>);     <span class="comment">//Copy string to our BYTE array</span></div>
<div class="line">    <a name="a8"></a><a class="code" href="nz__circular_buffer_8h.html#a4fd6a9aa372df330bd88444bb0ee61ac">cbufPutPacket</a>(&amp;cbufTest, arr1, 12);     <span class="comment">//Add this BYTE array to our &quot;Circular Buffer&quot; as a packet. Include string NULL (12 not 11)</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="nz__circular_buffer_8h.html#af00a8ce0f071a8a966bc66294fdd9081">cbufHasWholePacket</a>(&amp;cbufTest))</div>
<div class="line">        <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\n\nAfter adding packet, cbufHasWholePacket() returns true&quot;</span>);</div>
<div class="line">    size = <a name="a9"></a><a class="code" href="nz__circular_buffer_8h.html#a537f0230c389a8c3aca5bca45d98557e">cbufGetContiguousPacket</a>(&amp;cbufTest, &amp;pByte);      <span class="comment">//Get pointer to packet data. Nothing is removed!</span></div>
<div class="line">    <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\nTest string (size=%d) is: %s&quot;</span>, size, pByte);  <span class="comment">//Below we will remove and print string</span></div>
<div class="line">    <a name="a10"></a><a class="code" href="nz__circular_buffer_8h.html#a41ff25acfdec531e69b8437abb11b720">cbufRemovePacket</a>(&amp;cbufTest);            <span class="comment">//Remove packet</span></div>
<div class="line">    <a class="code" href="stdio_8h.html#a98631211a4a8aee62f572375d5b637be">printf</a>(<span class="stringliteral">&quot;\nSize is now %d&quot;</span>, <a name="a11"></a><a class="code" href="nz__circular_buffer_8h.html#a4b57fbfd7719fe18b0cdfa42594f6824">cbufGetCount</a>(&amp;cbufTest));</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Main loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <a name="a12"></a><a class="code" href="nz__netcruzer_8h.html#ad9122988f6a0fb44a89afca419b66e65">nzSysTaskDefault</a>();     <span class="comment">//Main netcruzer task, call in main loop.</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if defined(HAS_NZ_DEBUGGING)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">void</span> debugService(<span class="keywordtype">void</span>) {</div>
<div class="line">    <span class="comment">//Check if a debug message was received</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="nz__circular_buffer_8h.html#af00a8ce0f071a8a966bc66294fdd9081">cbufHasWholePacket</a>(CIRBUF_RX_DEBUG)) {</div>
<div class="line">        <span class="comment">//Check if we received &quot;hi&quot;. If so, reply with &quot;Hello&quot; on a new line</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a13"></a><a class="code" href="nz__circular_buffer_8h.html#a5ce13d16c59e3a6e02d750c462d9aad6">cbufPacketStrcmp</a>(CIRBUF_RX_DEBUG, <span class="stringliteral">&quot;hi&quot;</span>) == 0) {</div>
<div class="line">            debugPutString(<span class="stringliteral">&quot;\nHello&quot;</span>);</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">//Check if we received &quot;hello&quot;. If so, reply with &quot;G&#39;Day Mate!&quot; on a new line</span></div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="nz__circular_buffer_8h.html#a5ce13d16c59e3a6e02d750c462d9aad6">cbufPacketStrcmp</a>(CIRBUF_RX_DEBUG, <span class="stringliteral">&quot;myMessage...&quot;</span>) == 0) {</div>
<div class="line">            <span class="comment">//Do something.....</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Remove received packet. If it was not processed above, it is lost!</span></div>
<div class="line">        <a class="code" href="nz__circular_buffer_8h.html#a41ff25acfdec531e69b8437abb11b720">cbufRemovePacket</a>(CIRBUF_RX_DEBUG);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 9 2014 15:08:18 for Netcruzer Library API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
