<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer: device_HID_demo2/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer
   &#160;<span id="projectnumber">V1.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('device__h_i_d_demo2_2main_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">device_HID_demo2/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<h2>===== Description =====</h2>
<div class="fragment"><div class="line">This demo monitors the USB port <span class="keywordflow">for</span> any Debug messages. If anything is received, it replies with <span class="stringliteral">&quot;Hello&quot;</span> <span class="keywordtype">string</span>.</div>
<div class="line">Use the <span class="stringliteral">&quot;Netcruzer USB Terminal&quot;</span> app to send and receive USB Debug messages. It can be downloaded here:</div>
<div class="line">http:<span class="comment">//www.netcruzer.com/usbterminal/</span></div>
</div><!-- fragment --><h2>===== Required Hardware =====</h2>
<p>The project requires a <a href="http://netcruzer.com/sbc66-boards/">SBC66 Netcruzer board</a> with an USB Port (not USB Host).</p>
<h2>===== Building Project =====</h2>
<p>This project is located in the "src/demos/usb/device_HID_demo2" folder of the <a href="http://netcruzer.com/nzdownload/" target="_blank">Netcruzer Download</a>. To compile for Netcruzer Board, open this project in MPLAB X, and select the "Project Configuration" for desired board. For example "SBC66ZL_R1" for the <a href="http://netcruzer.com/sbc66zl.html">SBC66ZL</a> Revision 1 board. For details <a href="http://netcruzer.com/nz/doc/building_projects/" target="_blank">click here</a> A common error is "The system cannot find the path specified". This generally means you don't have the required XC16 compiler version installed. Go to "Project Properties", and select your installed XC16 compiler in the "Project Configuration" section.</p>
<h2>===== Programming Board =====</h2>
<p>After compiling (build), the board can be programmed via the <a href="http://netcruzer.com/nz/doc/update_firmware_usb" target="_blank">USB Bootloader</a> or a <a href="http://netcruzer.com/nz/doc/update_firmware_prog" target="_blank">PIC Programmer</a>. USB Programming is simplified when using the SBC board together with a <a href="http://netcruzer.com/nz/doc/update_firmware_usb_pt66" target="_blank">Prototype Board</a>.</p>
<h2>===== File History =====</h2>
<p>2013-07-22, David H. (DH):</p>
<ul>
<li>Initial version</li>
</ul>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#ifndef MAIN_C</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MAIN_C</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;HardwareProfile.h&quot;</span>    <span class="comment">//Required for all Netcruzer projects</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Other Includes</span></div>
<div class="line"><span class="preprocessor">#include &quot;main.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;nz_usbCmdAndDebug.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Add debugging to this file. The DEBUG_CONF_MAIN macro sets debugging to desired level, and is configured in &quot;Debug Configuration&quot; section of projdefs.h file</span></div>
<div class="line"><span class="preprocessor">#if !defined(DEBUG_CONF_MAIN)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">    #define DEBUG_CONF_MAIN     0   //Debugging not enabled for this file!</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define MY_DEBUG_LEVEL   DEBUG_CONF_MAIN</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="nz__debug_8h.html" title="This file defines a Debug interface. ">nz_debug.h</a>&quot;</span></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">WORD sysLedMask;    <span class="comment">//Used for LED flashing pattern. Has 1 set bit, and it rotated left every 50ms.</span></div>
<div class="line">WORD sysLedPattern; <span class="comment">//Used for blinking system LED</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Function Prototypes</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> LEDTask(<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="comment">// Main application entry point.</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div>
<div class="line">    WORD tmrFlashLed = 0;  <span class="comment">//Timer for flashing system LED</span></div>
<div class="line"><span class="preprocessor">    #if defined(USB_IS_CDC)</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordtype">char</span> buf[32];</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <a name="a0"></a><a class="code" href="nz__netcruzer_8h.html#a591be19f2f4adb5f84d6e21413b0fcc4">nzsysInitDefault</a>();             <span class="comment">//Default initialization. All ports inputs. All analog features disabled. Tick 1ms</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// LEDs</span></div>
<div class="line">    DIR_SYSLED = OUTPUT_PIN;</div>
<div class="line">    OUT_SYSLED = 0;</div>
<div class="line"></div>
<div class="line">    sysLedMask = 0x0001;</div>
<div class="line">    sysLedPattern = 0x0f0f;         <span class="comment">//Blink</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">// Initialize USB</span></div>
<div class="line">    <a name="a1"></a><a class="code" href="nz__usb_buffered_8h.html#a4552b1c9fe142a402c84c15444d3d927">usbInit</a>();</div>
<div class="line">    <a name="a2"></a><a class="code" href="nz__debug_8h.html#aef108fc92eb7f83ec3e4a30cf24cca75">debugInit</a>();</div>
<div class="line">    usbCmdAndDebugInit();</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">    #if defined(USB_INTERRUPT)</span></div>
<div class="line"><span class="preprocessor"></span>    USBDeviceAttach();</div>
<div class="line"><span class="preprocessor">    #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="comment">//Main loop</span></div>
<div class="line">    <span class="keywordflow">while</span> (1) {</div>
<div class="line">        <a name="a3"></a><a class="code" href="nz__netcruzer_8h.html#ad2f434650d0ff9e33add69c425c41771">nzsysTaskDefault</a>();     <span class="comment">//Main netcruzer task, call in main loop.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">//Enter every 100ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a4"></a><a class="code" href="nz__tick_8h.html#aa0f42d9f39952fe9447d27c21a6d40ab">tickHasExpired</a>(tmrFlashLed)) {</div>
<div class="line">            <a name="a5"></a><a class="code" href="nz__tick_8h.html#a2138d47ebbf6ffc2b938caf12c5d7f29">tickUpdateMS</a>(tmrFlashLed, 100); <span class="comment">//Update timer to expire in 100ms again</span></div>
<div class="line">            LEDTask();</div>
<div class="line">            <span class="comment">//DEBUG_PUT_STR(DEBUG_LEVEL_ERROR, &quot;.&quot;);</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="comment">//        #if defined(USB_INTERRUPT)</span></div>
<div class="line"><span class="comment">//        if (USB_BUS_SENSE &amp;&amp; (USBGetDeviceState() == DETACHED_STATE)) {</span></div>
<div class="line"><span class="comment">//            USBDeviceAttach();</span></div>
<div class="line"><span class="comment">//        }</span></div>
<div class="line"><span class="comment">//        #endif</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">        #if defined(USB_POLLING)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">// Check bus status and service USB interrupts.</span></div>
<div class="line">        USBDeviceTasks(); <span class="comment">// Interrupt or polling method.  If using polling, must call</span></div>
<div class="line">        <span class="comment">// this function periodically.  This function will take care</span></div>
<div class="line">        <span class="comment">// of processing and responding to SETUP transactions</span></div>
<div class="line">        <span class="comment">// (such as during the enumeration process when you first</span></div>
<div class="line">        <span class="comment">// plug in).  USB hosts require that USB devices should accept</span></div>
<div class="line">        <span class="comment">// and process SETUP packets in a timely fashion.  Therefore,</span></div>
<div class="line">        <span class="comment">// when using polling, this function should be called</span></div>
<div class="line">        <span class="comment">// regularly (such as once every 1.8ms or faster** [see</span></div>
<div class="line">        <span class="comment">// inline code comments in usb_device.c for explanation when</span></div>
<div class="line">        <span class="comment">// &quot;or faster&quot; applies])  In most cases, the USBDeviceTasks()</span></div>
<div class="line">        <span class="comment">// function does not take very long to execute (ex: &lt;100</span></div>
<div class="line">        <span class="comment">// instruction cycles) before it returns.</span></div>
<div class="line"><span class="preprocessor">        #endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <a name="a6"></a><a class="code" href="nz__usb_buffered_8h.html#a147d335ec1c924a67525f984a489ae16">usbTask</a>();</div>
<div class="line"></div>
<div class="line">        <a name="a7"></a><a class="code" href="nz__debug_8h.html#addfce27149a0d6607385cbfdbe0f7cbf">debugService</a>();</div>
<div class="line"></div>
<div class="line">        usbCmdAndDebugTask();</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> LEDTask(<span class="keywordtype">void</span>) {</div>
<div class="line">    sysLedMask = sysLedMask &lt;&lt; 1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (sysLedMask == 0) {</div>
<div class="line">        sysLedMask = 0x0001;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (sysLedPattern &amp; sysLedMask) {</div>
<div class="line">        OUT_SYSLED = 1;  <span class="comment">// Turn the LED on</span></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        OUT_SYSLED = 0;  <span class="comment">// Turn the LED off</span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Aug 5 2013 10:16:20 for Netcruzer by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
