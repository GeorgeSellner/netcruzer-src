<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer: db66dev1_demo3_nodriver/main.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer
   &#160;<span id="projectnumber">V2.02</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('db66dev1_demo3_nodriver_2main_8c-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">db66dev1_demo3_nodriver/main.c</div>  </div>
</div><!--header-->
<div class="contents">
<h2>===== Description =====</h2>
<p>This demo contains some test code for the DB66DEV1 development daughter board. It does NOT use the DB66DEV1 driver located in <a class="el" href="nz__db66dev1_8h.html" title="Contains hardware specific defines for DB66DEV1 Revision 1 board. ">nz_db66dev1.h</a>, because we want to show how to control the hardware without the driver doing it all! The 4 buttons on the DB66DEV1 will simply control LEDs 4 to 8 (on/off when button pressed/depressed). We will check the voltage on the Analog input (connected to potentiomer on DB66DEV1) and if above 2.0V turn on LED1 and sound the buzzer.</p>
<p>The DB66DEV1 has a potentiometer on port X3. This port has an ADC (Analog to Digital) converter on all SBC66 Netcruzer boards. The SBC66 Netcruzer boards have 12 Analog input ports, port X0-X5, and Y0-Y5. For details see <a href="http://netcruzer.com/nzdoc-sbc66-ports/">http://netcruzer.com/nzdoc-sbc66-ports/</a></p>
<p>The DB66DEV1 has 4 button on ports Y0, Y1, Y2 and Y3. They are all configured as inputs.</p>
<p>The DB66DEV1 has 8 LEDs on ports X6, X7, X8, X9, T4, T5, T6 and T7. These ports are all configured as outputs.</p>
<p>Port X3 is configured as an Analog Inputs. By default the ADC is configured for voltages between 0 - 2.5V (To configure it for 3.3V inputs, see <a class="el" href="nz__analog_8h.html" title="Internal ADC functions. ">nz_analog.h</a> file).</p>
<p>Additionally the System LED blinks every second.</p>
<h2>===== Required Hardware =====</h2>
<p>The project requires a <a href="http://netcruzer.com/sbc66-boards/">SBC66 Netcruzer board</a> with an USB Port (not USB Host), <b>AND</b> a <a href="http://netcruzer.com/db66dev1.html">DB66DEV1</a> development board. The DB66DEV1 is plugged into the daughter board connector of the SBC66 board.</p>
<h2>===== Building Project =====</h2>
<p>This project is located in the "src/demos/db66dev1/db66dev1_demo3_nodriver" folder of the <a href="http://netcruzer.com/nzdownload/" target="_blank">Netcruzer Download</a>. To compile for Netcruzer Board, open this project in MPLAB X, and select the "Project Configuration" for desired board. For example "SBC66ECL_R2" for the <a href="http://netcruzer.com/sbc66ecl.html">SBC66ECL</a> Revision 2 board. For details <a href="http://netcruzer.com/nz/doc/building_projects/" target="_blank">click here</a> A common error is "The system cannot find the path specified". This generally means you don't have the required XC16 compiler version installed. Go to "Project Properties", and select your installed XC16 compiler in the "Project Configuration" section.</p>
<h2>===== Programming Board =====</h2>
<p>After compiling (build), the board can be programmed via the <a href="http://netcruzer.com/nz/doc/update_firmware_usb" target="_blank">USB Bootloader</a> or a <a href="http://netcruzer.com/nz/doc/update_firmware_prog" target="_blank">PIC Programmer</a>. USB Programming is simplified when using the SBC board together with a <a href="http://netcruzer.com/nz/doc/update_firmware_usb_pt66" target="_blank">Prototype Board</a>.</p>
<h2>===== File History =====</h2>
<p>2013-05-03, David H. (DH):</p>
<ul>
<li>Initial version</li>
</ul>
<div class="fragment"><div class="line"></div>
<div class="line"><span class="preprocessor">#define THIS_IS_MAIN_FILE   //Uniquely identifies this as the file with the main application entry function main()</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &quot;HardwareProfile.h&quot;</span>    <span class="comment">//Required for all Netcruzer projects</span></div>
<div class="line"></div>
<div class="line"><span class="comment">//Button defines</span></div>
<div class="line"><span class="preprocessor">#define BUTTON1         PIN_Y0</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON2         PIN_Y1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON3         PIN_Y2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON4         PIN_Y3</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON1_PULLUP  PULLUP_Y0</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON2_PULLUP  PULLUP_Y1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON3_PULLUP  PULLUP_Y2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON4_PULLUP  PULLUP_Y3</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON1_DIR     DIR_Y0</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON2_DIR     DIR_Y1</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON3_DIR     DIR_Y2</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define BUTTON4_DIR     DIR_Y3</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">//LED define</span></div>
<div class="line"><span class="preprocessor">#define LED1        LAT_X6</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED2        LAT_X7</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED3        LAT_X8</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED4        LAT_X9</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED5        LAT_T4</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED6        LAT_T5</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED7        LAT_T6</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED8        LAT_T7</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED1_DIR    DIR_X6</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED2_DIR    DIR_X7</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED3_DIR    DIR_X8</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED4_DIR    DIR_X9</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED5_DIR    DIR_T4</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED6_DIR    DIR_T5</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED7_DIR    DIR_T6</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define LED8_DIR    DIR_T7</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">//Other defines</span></div>
<div class="line"><span class="preprocessor">#define BUZZ_PERIOD   PWM_CALCULATE_PERIOD_FOR_FREQUENCY(1000)</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    WORD tmrFlashLed = 0;   <span class="comment">//Timer for flashing system LED</span></div>
<div class="line">    WORD tmrProcessIO = 0;  <span class="comment">//Timer for processing I/O</span></div>
<div class="line"></div>
<div class="line">    <a name="a0"></a><a class="code" href="nz__netcruzer_8h.html#a591be19f2f4adb5f84d6e21413b0fcc4">nzsysInitDefault</a>();         <span class="comment">//Default initialization. All ports inputs. All analog features disabled. Tick 1ms</span></div>
<div class="line"></div>
<div class="line">    DIR_SYSLED = OUTPUT_PIN;    <span class="comment">//Set System LED port as outputs</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//LED outputs</span></div>
<div class="line">    LED1_DIR = OUTPUT_PIN;</div>
<div class="line">    LED2_DIR = OUTPUT_PIN;</div>
<div class="line">    LED3_DIR = OUTPUT_PIN;</div>
<div class="line">    LED4_DIR = OUTPUT_PIN;</div>
<div class="line">    LED5_DIR = OUTPUT_PIN;</div>
<div class="line">    LED6_DIR = OUTPUT_PIN;</div>
<div class="line">    LED7_DIR = OUTPUT_PIN;</div>
<div class="line">    LED8_DIR = OUTPUT_PIN;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Configure Button ports as inputs</span></div>
<div class="line">    BUTTON1_DIR = <a name="a1"></a><a class="code" href="nz__board_8h.html#a1a806e0533aa476bb6e62b7d22c93572" title="Macros for input and output pins. ">INPUT_PIN</a>;</div>
<div class="line">    BUTTON2_DIR = <a class="code" href="nz__board_8h.html#a1a806e0533aa476bb6e62b7d22c93572" title="Macros for input and output pins. ">INPUT_PIN</a>;</div>
<div class="line">    BUTTON3_DIR = <a class="code" href="nz__board_8h.html#a1a806e0533aa476bb6e62b7d22c93572" title="Macros for input and output pins. ">INPUT_PIN</a>;</div>
<div class="line">    BUTTON4_DIR = <a class="code" href="nz__board_8h.html#a1a806e0533aa476bb6e62b7d22c93572" title="Macros for input and output pins. ">INPUT_PIN</a>;</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Enable pull-up resistors for all button inputs</span></div>
<div class="line">    BUTTON1_PULLUP = 1;</div>
<div class="line">    BUTTON2_PULLUP = 1;</div>
<div class="line">    BUTTON3_PULLUP = 1;</div>
<div class="line">    BUTTON4_PULLUP = 1;</div>
<div class="line"></div>
<div class="line">    <a name="a2"></a><a class="code" href="nz__analog_8h.html#ae988ce1360560a132af27c980de8dd27">adcOpen</a>(ADC_OPEN_X3);       <span class="comment">//Configure X3 as ADC channels</span></div>
<div class="line"></div>
<div class="line">    <span class="comment">//Configure Y4 (Buzzer on DB66DEV1) as PWM channel 1, with default frequency of 16kHz.</span></div>
<div class="line">    <span class="comment">//The value of the PWM1_FREQ define determines the frequency, and is 16kHz by default.</span></div>
<div class="line">    <span class="comment">//To change the default frequency, do one of the following:</span></div>
<div class="line">    <span class="comment">// - Redefine PWM1_FREQ in projdefs.h file for desired frequency (For example: #define PWM1_FREQ  PWM_FREQ_80KHZt)</span></div>
<div class="line">    <span class="comment">// - Call pwm1SetPeriod() with period for desired frequency</span></div>
<div class="line">    <a name="a3"></a><a class="code" href="nz__pwm_8h.html#a52726762eb175587d34e5ac546c25057">pwm1OpenDefault</a>(PPS_OUT_Y4, 0);</div>
<div class="line"></div>
<div class="line">    <span class="comment">//Update period of PWM to 1kHz (defined in BUZZ_PERIOD), the pwm1OpenDefault() function</span></div>
<div class="line">    <span class="comment">//configured it to 16kHz by defailt.</span></div>
<div class="line">    <a name="a4"></a><a class="code" href="nz__pwm_8h.html#accf1920acf114075642edc02209941fb">pwm1SetPeriod</a>( BUZZ_PERIOD );</div>
<div class="line">    <a name="a5"></a><a class="code" href="nz__pwm_8h.html#a90cb0586e17ab3230f2e4fe859c9c317">pwm1SetDutyCycle</a>(0);            <span class="comment">//Set duty cycle to 0, turns buzzer off</span></div>
<div class="line"></div>
<div class="line"><span class="keywordflow">while</span>(1)</div>
<div class="line">    {</div>
<div class="line">        <a name="a6"></a><a class="code" href="nz__netcruzer_8h.html#ad2f434650d0ff9e33add69c425c41771">nzsysTaskDefault</a>();     <span class="comment">//Main netcruzer task, call in main loop.</span></div>
<div class="line"></div>
<div class="line">        <span class="comment">//Process I/O every 50ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a name="a7"></a><a class="code" href="nz__tick_8h.html#aa0f42d9f39952fe9447d27c21a6d40ab">tickHasExpired</a>(tmrProcessIO)) {</div>
<div class="line">            <a name="a8"></a><a class="code" href="nz__tick_8h.html#a2138d47ebbf6ffc2b938caf12c5d7f29">tickUpdateMS</a>(tmrProcessIO, 50); <span class="comment">//Update timer to expire in 100ms again</span></div>
<div class="line"></div>
<div class="line">            LED5 = !BUTTON1;    <span class="comment">//Turn on LED 5 if button 1 pressed, and off if not</span></div>
<div class="line">            LED6 = !BUTTON2;    <span class="comment">//Turn on LED 6 if button 2 pressed, and off if not</span></div>
<div class="line">            LED7 = !BUTTON3;    <span class="comment">//Turn on LED 7 if button 3 pressed, and off if not</span></div>
<div class="line">            LED8 = !BUTTON4;    <span class="comment">//Turn on LED 8 if button 4 pressed, and off if not</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">//If analog input is above 2.0V (2000mV), turn LED1 and Buzzer on</span></div>
<div class="line">            <span class="keywordflow">if</span> (<a name="a9"></a><a class="code" href="nz__analog_8h.html#a3e6b23e06b7350d7d9c7adde0bac0b5d">adcGetChanMv</a>(ADC_CH_X3) &gt; 2000) {</div>
<div class="line">                LED1 = 1;               <span class="comment">//Turn LED on</span></div>
<div class="line"></div>
<div class="line">                <span class="comment">//Set duty cycle to 50% (period/2). This gives maximum volume on buzzer</span></div>
<div class="line">                <a class="code" href="nz__pwm_8h.html#a90cb0586e17ab3230f2e4fe859c9c317">pwm1SetDutyCycle</a>( BUZZ_PERIOD/2 );</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">                LED1 = 0;               <span class="comment">//Turn LED off</span></div>
<div class="line">                <a class="code" href="nz__pwm_8h.html#a90cb0586e17ab3230f2e4fe859c9c317">pwm1SetDutyCycle</a>(0);    <span class="comment">//Set duty cycle to 0%, buzzer if off</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="comment">//Flash system LED every 500ms</span></div>
<div class="line">        <span class="keywordflow">if</span> (<a class="code" href="nz__tick_8h.html#aa0f42d9f39952fe9447d27c21a6d40ab">tickHasExpired</a>(tmrFlashLed)) {</div>
<div class="line">            <a class="code" href="nz__tick_8h.html#a2138d47ebbf6ffc2b938caf12c5d7f29">tickUpdateMS</a>(tmrFlashLed, 500); <span class="comment">//Update timer to expire in 500ms again</span></div>
<div class="line">            LAT_SYSLED = !LAT_SYSLED;       <span class="comment">//Toggle System LED</span></div>
<div class="line">        }</div>
<div class="line">    }<span class="comment">//end while</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}<span class="comment">//end main</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if !defined(PPS_OUT_Y4)</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#error &quot;Can not build for this target, it does not have a reconfigurable Y4 pin! This is the case for the SBC66EC Revision 1 board. Select a different Configuration!&quot;</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Sep 7 2013 13:09:27 for Netcruzer by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
