<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer Library API: USB Bootloader</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer Library API
   &#160;<span id="projectnumber">V2.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__info__update__usb.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">USB Bootloader<div class="ingroups"><a class="el" href="group__info__update.html">Updating Firmware</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>The <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> application is used to update the firmware on SBC boards via the USB port.</p>
<p><br/>
 </p>
<h1><a class="anchor" id="info_update_usb_procedure"></a>
Procedure</h1>
 
<div class="floatDivR">
    <img src="jmp_f_320.jpg"/>
    <div style="margin:5px;">&nbsp;Picture 1. Jumper in "Firmware Upgrade" position</div>
        <br><hr>
    <img src="jmp_park_320.jpg"/>
        <div style="margin:5px;">&nbsp;Picture 2. Jumper in "Park" position</div>
</div>
 The procedure for updating the firmware on current Netcruzer SBC boards with a USB port is:</p>
<ol type="1">
<li>Power off the SBC board, and start the <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> application.</li>
<li>On connector X1 of the SBC board, place the jumper in the "F" position. See Picture 1.</li>
<li>Connect the SBC board to the PC via a USB cable, and power the SBC board.</li>
<li>The <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> should show "Device Attached" in it's message window.</li>
<li>Use &lt;File&gt;&lt;Import Firmware Image&gt; menu to load the firmware hex file.</li>
<li>Select &lt;Program&gt;&lt;Erase/Program/Verify Device&gt; from menu. This will upload the new firmware to the external Flash chip of the SBC board. Only after the download has been verified, the new firmware is marked as "new firmware". This ensures that no error occurs if the download is not successful.</li>
<li>Power off the SBC board, and place the jumper back in the "Park" position. See Picture 2. Jumper can also be removed.</li>
<li>At the next power up, the SBC board will be programmed with the firmware. The previous firmware is marked as "previous firmware", allowing a roll-back to previous firmware.</li>
</ol>
<p><b>Alternatively</b>, a button can be connected between the <a href="http://netcruzer.com/nzdoc-sbc66-ports">T1 port</a> and VCC (3.3V) of the SBC board. At power-up, if this button is pressed, the board will enter bootloader mode, and can be programmed as described in steps 6 to 8 above. Some prototype boards have this button, and can be programmed <a class="el" href="group__info__update__usb__pt66.html#info_update_usb_pt66_procedure">as descibed here</a>.</p>
<p><br/>
 </p>
<h1><a class="anchor" id="info_update_usb_secure"></a>
Secure Method</h1>
<p>The firmware is updated in a very secure manner. Even a power failure during the firmware update process will not result in the board being programmed with faulty firmware. For details, <a class="el" href="group__info__update.html#info_update_details">click here</a>.</p>
<p><br/>
 </p>
<h1><a class="anchor" id="info_update_usb_sysled"></a>
System LED</h1>
<p>The system LED will indicate the state of the board when in bootloader mode (jumper on "F"). There will always be two long flashes, followed by 1 to 3 short flashes. The state of the bootloader is:</p>
<p><br/>
 </p>
<h3>Bootloader Mode, USB unplugged</h3>
<p>When the board is in bootloader mode, but the USB connection is not active, the LED will have 2 long flashes, followed by 1 short flash every 3.2 seconds. </p>
<table  border="0">
<tr>
<td width="740px" align="center">3.2 Seconds (times below in ms) </td></tr>
</table>
<table class="doxtable">
<tr style="text-align:center; font-family: Arial; font-size:10px; font-weight:bold;">
<td bgcolor="red" width="80px">400 On </td><td bgcolor="gray" width="80px">400 Off </td><td bgcolor="red" width="80px">400 On </td><td bgcolor="gray" width="80px">400 Off </td><td bgcolor="red" width="20px" style="font-size:8px;">100 On </td><td bgcolor="gray" width="300px">1500 Off </td></tr>
</table>
<p>LED flash pattern is 400ms ON, 400ms OFF, 400ms ON, 400ms OFF, 100ms ON, 1500ms OFF.</p>
<p><br/>
 </p>
<h3>Bootloader Mode, USB plugged in</h3>
<p>When the board is in bootloader mode, and the USB port is plugged in and initialized, the LED will have 2 long flashes, followed by 2 short flashes every 3.2 seconds. New firmware can be uploaded via the <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> application. </p>
<table  border="0">
<tr>
<td width="740px" align="center">3.2 Seconds (times below in ms) </td></tr>
</table>
<table class="doxtable">
<tr style="text-align:center; font-family: Arial; font-size:10px; font-weight:bold;">
<td bgcolor="red" width="80px">400 On </td><td bgcolor="gray" width="80px">400 Off </td><td bgcolor="red" width="80px">400 On </td><td bgcolor="gray" width="80px">400 Off </td><td bgcolor="red" width="20px" style="font-size:9px;">100 On </td><td bgcolor="gray" width="20px" style="font-size:9px;">100 Off </td><td bgcolor="red" width="20px" style="font-size:8px;">100 On </td><td bgcolor="gray" width="240px">1500 Off </td></tr>
</table>
<p>LED flash pattern is 400ms ON, 400ms OFF, 400ms ON, 400ms OFF, 100ms ON, 200ms OFF, 100ms ON, 1200ms OFF.</p>
<p><br/>
 </p>
<h1><a class="anchor" id="info_update_usb_details"></a>
Details</h1>
<p>The <em>USB Bootloader</em> is a project, located in the ".../src/projects/usb_hid_boot" folder of the <a class="el" href="group__devtools__nz__download.html">Netcruzer Download</a>. This folder contains all source code, MPLAB projects and documentation for the <em>USB Bootloader</em>. Details about the <em>USB Bootloader</em> project <a class="elRef" doxygen="E:/prj/netcruzer/doxygen/proj_usb_hid_boot.tag:projects/usb_hid_boot/" href="projects/usb_hid_boot/index.html#proj_usbboot_intro">is available here</a>.</p>
<p><br/>
 </p>
<h1><a class="anchor" id="info_update_usb_trouble"></a>
Troubleshooting</h1>
<h3>LED not blinking as described when placing jumper in "F" position</h3>
<p>It is possible that a <a class="el" href="sbc66.html">SBC66 Boards</a> board is not programmed with the <em>USB Bootloader</em>, or it got deleted.</p>
<ul>
<li>Some early boards (prior to June 2012) were shipped without the <em>USB Bootloader</em>.</li>
<li>If programming a board with a PIC Programmer, the <em>USB Bootloader</em> will most likely get deleted.</li>
</ul>
<p>If this is the case, a PIC programmer is required to restore it, <a class="elRef" doxygen="E:/prj/netcruzer/doxygen/proj_usb_hid_boot.tag:projects/usb_hid_boot/" href="projects/usb_hid_boot/group__proj__usbboot__update.html">as described here</a>.</p>
<p><br/>
<br/>
<br/>
 </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 9 2014 15:08:20 for Netcruzer Library API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
