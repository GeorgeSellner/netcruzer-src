<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.4"/>
<title>Netcruzer Library API: Application Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Netcruzer Library API
   &#160;<span id="projectnumber">V2.03</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.4 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__info__conf__app.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Application Configuration<div class="ingroups"><a class="el" href="group__info__conf.html">Configuration</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>All SBC66 Netcruzer boards have an external EEPROM and FLASH, which is normally used by the project to store application configuration data. The "nz_appConfig.h" file provides an interface for storing, retrieving and modifying application configuration data. It is recommended to implement it in a project if application configuration data is required.</p>
<p>For details how a projects stores it's configuration data, refer to the specific <a class="el" href="group__info__proj.html">Project's</a> documentation.</p>
<p>The application configuration is stored in the external EEPROM of the SBC board. It is stored in the CFG_STRUCT section of the EEPROM. The XEEMEM_USER_START_ADR and XEEMEM_USER_END_ADR defines should be used to get the address range available for user data.</p>
<h1><a class="anchor" id="info_conf_app_memmap"></a>
External EEPROM Memory Map</h1>
<p>The external EEPROM is devided into various sections, as defined by XEEMEM_xxx defines. For example, if the user wants to use the external EEPROM for project specific data, the XEEMEM_USER_START_ADR define should be used to located the "User EEPROM" space.</p>
<p>The following example shows the memory map for the "Webserver" project: </p>
<table class="doxtable">
<tr>
<td><b>0x0000-0x001F</b> (0-31) </td><td><a class="el" href="struct_c_f_g___i_n_f_o.html">CFG_INFO</a> - Info, Magic Number, CRC... Used for checksum calculations, and to check if EEPROM contains valid data.  </td></tr>
<tr>
<td><b>0x0020-0x03FF</b> (32-1023) </td><td><a class="el" href="struct_c_f_g___c_o_p_y.html">CFG_COPY</a> - Copy of last written settings. Use write blocks of 32 bytes  </td></tr>
<tr>
<td><b>0x0400-0x0FFF</b> (1024-4095) </td><td>CFG_STRUCT - Main Content.<br/>
In code this address range is defined by the XEEMEM_CFG_STRUCT_START_ADR and XEEMEM_CFG_STRUCT_END_ADR defines.  </td></tr>
<tr>
<td><b>0x1000-0x1FFF</b> (4096-8191) </td><td><b>User EEPROM</b> space, can be used by user application to store non volatile data.<br/>
In code this address range is defined by the XEEMEM_USER_START_ADR and XEEMEM_USER_END_ADR defines.  </td></tr>
</table>
<h1><a class="anchor" id="info_conf_app_details"></a>
Details</h1>
<p>The default configuration is stored in the cfgStructHexfile and cfgStruct structures in the project's appConfig.c file. Both these strucures should be kept identical! When making a change to one, do the same to the other!</p>
<ul>
<li>The <b>cfgStructHexfile</b> structure places the default configuration in the generated hex file at byte address 0x1000000. This is outside the target device's FLASH program memory, and will not be used by a PIC programmer. This data is only used by the <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> The <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> takes this data from the hex file, and programs it onto the external FLASH of the target board when doing a firmware upgrade. This default configuration data is then used by the target board to update it's application configuration data.</li>
<li>The <b>cfgStruct</b> structure places the default configuration in the target device's FLASH program memory. It only happens when the CFG_STRUCT_IN_CODE macro is defines. This has to be done when the firmware is NOT programmed with the <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a>, but with a PIC programmer. The reason is that the cfgStructHexfile is only programmed into the target's external EEPROM when the <a class="el" href="group__devtools__nz_usb_bootloader.html">Netcruzer USB Bootloader</a> is used. When a PIC programmer is used, the cfgStruct is required. It uses additional FLASH program memory of the target! When the CFG_STRUCT_IN_CODE macro is defined, the firmware will update the application configuration data (in external EEPROM) with the contents of the cfgStruct structure.</li>
</ul>
<h1><a class="anchor" id="info_conf_app_read"></a>
Reading AppConfig</h1>
<h1><a class="anchor" id="info_conf_app_modify"></a>
Modifying AppConfig</h1>
<p>When upgrading firmware, the old configuration data should be preserved. To do this, it is very important that if the config structures are changed in new firmware, changes are ONLY made to back of structure. The upgrade process will work as follows:</p>
<ul>
<li>Find current copy of CFG_STRUCT in external FLASH. Remember it as "Previous CFG_STRUCT"</li>
<li>Overwrite external EEPROM with new CFG_STRUCT (contained in new firmware)</li>
<li>Iterate through all CFG_BLOCKs in "Previous CFG_STRUCT". For each one found, search for the corresponding CFG_BLOCK in new CFG_STRUCT (external EEPROM). When found, copy data from "Previous" CFG_BLOCK to new one in external EEPROM. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Dec 9 2014 15:08:20 for Netcruzer Library API by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.4 </li>
  </ul>
</div>
</body>
</html>
